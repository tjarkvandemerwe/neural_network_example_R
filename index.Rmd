---
# title: "Neural Network Example in R"
output: 
  github_document:
    html_preview: false
    toc: true
    toc_depth: 2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Setup

### Goal
The goal is to create a working example of a basic deep neural network in R.
This example uses the tidyverse style of R. The main goal is clarity and explaining the concept, not speed or practical application.

### Packages
```{r library, message = FALSE, warning = FALSE}
library(tidyverse)
```


### Training data
The training data used in this example is fake data. And this example starts of with an output that is lineairly related to two input variables.
```{r fake_data, message = FALSE, warning = FALSE}
data <- tibble(
  input_value_1 = c(0:10) / 10,
  input_value_2 = c(10:0) / 50,
  output_value = c(0:10) / -5 + 1
)

data |> head(7)
```


### Setup neural network
```{r nn_parameters, message = FALSE, warning = FALSE}
input_neurons  <- 2
output_neurons <- 1
layers         <- 2
layer_neurons  <- 3
```

First a matrix of all weights (w) from the input neurons to the first layer of hidden neurons is created. This is an input_neurons x layer_neurons matrix, where input_neurons is the amount of neurons in the input layer, and layer_neurons is the amount of neurons per hidden layer.

```{r nn_input, message = FALSE, warning = FALSE}
nn_input <- list(
  w_input_hidden_layer_1 = matrix(sample(0:100 / 100, layer_neurons * input_neurons), nrow = input_neurons)
)

nn_input
```

If there are multiple hidden layers, the weights between these layers are created, this is an layer_neurons x layer_neurons matrix. Each hidden layer also has a bias value for every neuron in the layer. This is a single row matrix (vector) of length layer_neurons.
```{r nn_hidden_w, message = FALSE, warning = FALSE}

w_hidden_layers <- list()
b_hidden_layers <- list()

for(n in 1:layers){
  
  b_hidden <- list(matrix(sample(0:100 / 100, layer_neurons), nrow = 1))
  names(b_hidden) <- paste("b_hidden_layer", n , sep = "_")
  b_hidden_layers <- c(b_hidden_layers, b_hidden)
  
  if(n > 1){
    w_hidden <- list(matrix(sample(0:100 / 100, layer_neurons * layer_neurons), nrow = layer_neurons))
    names(w_hidden) <- paste("w_hidden_layer", n - 1, n, sep = "_")
    w_hidden_layers <- c(w_hidden_layers, w_hidden)
  }
}

nn_hidden <- c(w_hidden_layers, b_hidden_layers)
nn_hidden
```

```{r nn_output, message = FALSE, warning = FALSE}
nn_output <- list(
  w_output_layer_n = matrix(sample(0:100 / 100, layer_neurons * output_neurons), nrow = output_neurons),
  b_output_layer = matrix(sample(0:100 / 100, output_neurons), nrow = 1)
  )

nn_output
```
```{r nn_total, message = FALSE, warning = FALSE}
nn <- c(nn_input, nn_hidden, nn_output)
nn
```

# Forward propagation
